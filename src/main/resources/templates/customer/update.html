<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Update Customer</title>
    <style>
        .drop-area {
            width: 300px;
            height: 200px;
            border: 2px dashed #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .drop-area .highlight {
            background-color: #f0f0f0;
        }

        #preview-image {
            max-width: 100%;
            max-height: 300px;
            margin-top: 10px;
            object-fit: cover;
            object-position: center;
        }

    </style>
</head>
<body>
<h2>Update Customer</h2>
<button><a th:href="@{/customers}">Back to home</a></button>

<form th:action="@{/customers/update}" method="post" th:object="${customerDto}">
    <input type="hidden" th:field="*{id}"/>

    <div class="col-md-12">
        <p>Name</p>
        <input class="form-control" type="text" th:field="*{fullName}"
               required>
        <p style="color: red" th:if="${#fields.hasErrors('fullName')}"
           th:errors="*{fullName}"></p>
    </div>

    <div class="col-md-12">
        <p>Phone</p>
        <input class="form-control" type="number" th:field="*{phone}"
               required>
        <p style="color: red" th:if="${#fields.hasErrors('phone')}"
           th:errors="*{phone}"></p>
    </div>

    <div class="col-md-12">
        <p>Address</p>
        <input class="form-control" type="text" th:field="*{address}"
               required>
        <p style="color: red" th:if="${#fields.hasErrors('address')}"
           th:errors="*{address}"></p>
    </div>

    <div class="col-md-12">
        <label for="gender">Gender</label>
        <select class="form-control" id="gender" th:field="*{gender}" required>
            <option value="" disabled selected>Select gender</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
        </select>
        <p style="color: red" th:if="${#fields.hasErrors('gender')}"
           th:errors="*{gender}"></p>
    </div>

    <div class="col-md-12">
        <p>Date Of Birth</p>
        <input class="form-control" type="date" th:field="*{dob}"
               required>
        <p style="color: red" th:if="${#fields.hasErrors('dob')}"
           th:errors="*{dob}"></p>
    </div>

    <div id="drop-area" class="drop-area">
<!--        <p>Drag and Drop an image here .</p>-->
<!--        <img th:src="${customerDto.image}" alt="Preview" id="preview-image" style="display: none">-->
        <input type="hidden" id="thumbnailURL" th:field="*{image}" />
        <input type="file" id="btnThumbnailURL" class="form-control">
        <progress id="uploader" value="0" max="100">0%</progress>
    </div>


    <button id="submit" type="submit"
            style="width: 130px;height: 40px;background: #3893cc;border-radius: 30px;color: whitesmoke">
        Submit
    </button>

</form>
<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-analytics.js"></script>
<script>

    //paste here your copied configuration code
    const firebaseConfig = {
        apiKey: "AIzaSyCp05n7nwMvb43hJJZZVQn4ucIPKa2_gkA",
        authDomain: "retro-cinema-99f73.firebaseapp.com",
        projectId: "retro-cinema-99f73",
        storageBucket: "retro-cinema-99f73.appspot.com",
        messagingSenderId: "408180950215",
        appId: "1:408180950215:web:4b49fe816a9038473eaae2",
        measurementId: "G-8MJW1J4QL7"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    // const analytics = getAnalytics(app);
    let uploader = document.getElementById('uploader');
    let fileButton = document.getElementById('btnThumbnailURL');
    fileButton.addEventListener('change', function (e) {
        let file = e.target.files[0];
        let storageRef = firebase.storage().ref('retro/' + file.name);
        let task = storageRef.put(file);
        task.on('state_changed', function progress(snapshot) {
            let percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            uploader.value = percentage;
//  lúc chưa load xong thì thì ko cho submit
            if (percentage === 100) {
                document.getElementById('createButton').removeAttribute('disabled');
            } else {
                document.getElementById('createButton').setAttribute('disabled', 'disabled');
            }
        });
//   getDownloadURL() để lấy URL của file đã được lưu trữ trên Firebase Storage.
//   Sau khi URL được lấy thành công, nó được sử dụng để đặt giá trị cho thuộc tính value của phần tử HTML có id là thumbnailURL.
//   Điều này có nghĩa là URL được gán cho giá trị của trường input có tên là thumbnailURL.
//   Sau đó, URL này có thể được sử dụng để hiển thị hình ảnh hoặc thực hiện các thao tác khác liên quan đến hình ảnh trong code JavaScript và HTML.
        task.then(snapshot => snapshot.ref.getDownloadURL())
            .then(url => {
                document.getElementById('thumbnailURL').setAttribute("value", url);
// tải hình ảnh
                previewImage.style.display = 'none';
                newImage.src = url;
                newImage.style.display = 'block';
            });
    });

</script>
</body>
</html>