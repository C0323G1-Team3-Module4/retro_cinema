<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Booking</title>
    <!-- Link CSS -->
    <link rel="stylesheet" href="/static/css/bookings.css"/>
    <link rel="stylesheet" href="/static/css/ticket.css">
    <!-- Box Icon -->
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css"
    />
    <!-- or -->
    <link
            rel="stylesheet"
            href="https://unpkg.com/boxicons@latest/css/boxicons.min.css"
    />
    <!-- Using SweetAlert2 from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.all.min.js"></script>
</head>
<body>
<!-- Header -->
<header>
    <!-- Navigation Bar -->
    <div class="nav container">
        <!-- Logo -->
        <a href="/" class="logo"> Retro<span>Cinema</span> </a>
        <!-- Search Box -->
        <div class="search-box">
            <input
                    type="search"
                    th:name="name"
                    id="search-input"
                    placeholder="Search Movie"
            />
            <i class="bx bx-search" onclick="toSearch()"></i>
        </div>
        <!-- User -->
        <div>

        </div>
        <a href="#" class="user">
            <img th:if="${#request.userPrincipal == null}"
                 src="https://cdn.landesa.org/wp-content/uploads/default-user-image.png"
                 alt="user-img"
                 class="user-img"
            />
            <img th:if="${#request.userPrincipal !=null}"
                 src="https://cdn2.iconfinder.com/data/icons/audio-16/96/user_avatar_profile_login_button_account_member-512.png"
                 alt="user-img"
                 class="user-img">
            <span th:if="${#request.userPrincipal == null}" class="user-info" onclick="toLogin()">Login</span>
            <span th:if="${#request.userPrincipal !=null}" th:text="${#request.userPrincipal.getName()}"
                  class="user-info"></span>
            <!-- Dropdown list Start -->
            <div th:if="${#request.userPrincipal!=null}" class="dropdown-list">
                <div class="dropdown-item" th:if="${#request.isUserInRole('ROLE_ADMIN')}">
                    <i class="bx bx-cog"></i>
                    <div class="dropdown-text" onclick="toPreference()">Preferences</div>
                </div>
                <div class="dropdown-item" th:if="${#request.isUserInRole('ROLE_USER')}">
                    <i class="bx bx-cog"></i>
                    <div class="dropdown-text" onclick="toCustomerDetails()">Preferences</div>
                </div>
                <div class="dropdown-item">
                    <i class="bx bx-log-out-circle"></i>
                    <div class="dropdown-text" onclick="toLogout()">Log out</div>
                </div>
            </div>
            <!-- Dropdown list end -->
        </a>
        <!-- Nav bar column -->
        <div class="navbar">
            <a href="/" class="nav-link nav-active">
                <i class="bx bx-home"></i>
                <span class="nav-link-title">Home</span>
            </a>
            <a href="#home" class="nav-link">
                <i class="bx bxs-hot"></i>
                <span class="nav-link-title">Upcoming</span>
            </a>
            <a href="#home" class="nav-link">
                <i class="bx bx-camera-movie"></i>
                <span class="nav-link-title">Onscreen</span>
            </a>
            <a href="#home" class="nav-link">
                <i class="bx bx-heart"></i>
                <span class="nav-link-title">Favorite</span>
            </a>
        </div>
    </div>
</header>

<!-- Bookings Container Start -->
<div class="booking container">
    <div class="ticket-list">
        <div class="ticket-title">Your ticket(s)</div>
        <!-- Ticket Item Start -->
        <div class="ticket-item" th:each="ticket: ${tickets}">
            <div class="ticket">
                <div class="left">
                    <div class="image">
                        <img
                                class="image-item"
                                th:src="${ticket.getScreenings().getMovie().img}"
                                alt=""
                        />
                        <p class="admit-one">
                            <span>RetroCinema</span>
                        </p>
                    </div>
                    <div class="ticket-info">
                        <p class="date">
                            <span class="june-29" th:text="${ticket.getScreenings().getDateMovie()}">2023-01-01</span>
                        </p>
                        <div class="show-name">
                            <h2 th:text="${ticket.getScreenings().getMovie().movieName}">Movie Name</h2>
                        </div>
                        <div class="time">
                            <p>
                                <span th:text="${ticket.getScreenings().getShowTimes().getStartTime() + ' '}">8:00 PM</span>
                                <span>TO</span>
                                <span th:text="${' ' + ticket.getScreenings().getShowTimes().getEndTime() + ' '}">11:00 PM</span>
                                <span>@ &nbsp;</span>
                                <span th:text="${ticket.getScreenings().getShowTimes().getRooms().roomName}">Room</span>
                                <p th:text="${ticket.getSeats().getSeatName()}">Seat Name</p>
                            </p>
                        </div>
                        <p class="location">
                            <span>Retro Cinema -  </span>
                            <span> 280 Tran Hung Dao St.</span>
                        </p>
                    </div>
                </div>
                <div class="right">
                    <p class="admit-one">
                        <span>RetroCinema</span>
                    </p>
                    <div class="right-info-container">
                        <div class="time">
                            <p>
                                <span th:text="${ticket.getScreenings().getShowTimes().getStartTime() + ' '}">8:00 PM</span>
                                <span>@</span>
                                <span th:text="${' ' + ticket.getScreenings().getShowTimes().getRooms().roomName}">Room</span>
                            </p>
                            <p th:text="${ticket.getSeats().getSeatName()}">Seat Name</p>
                        </div>
                        <div class="barcode">
                            <img
                                    th:src="${ticket.getQrCode()}"
                                    alt="QR code"
                            />
                        </div>
                    </div>
                </div>
            </div>
            <div id="userIdHidden" th:text="${ticket.getAccountUser().id}" style="display: none"></div>
            <div id="screeningIdHidden" th:text="${ticket.getScreenings().id}" style="display: none"></div>
        </div>
        <!-- Ticket Item End -->
    </div>
</div>
<!-- Bookings Container End -->

<!-- Footer -->
<footer>
    <div class="info container">
        <div class="info-text">
            <p>280 Tran Hung Dao Street, Da Nang City, Viet Nam</p>
            <p>RETRO CINEMA &copy; COPYRIGHT 2023 ALL RIGHTS RESERVED</p>
        </div>
        <div class="info-logo">
            <a href="https://www.facebook.com" class="info-logo-item"
            ><i class="bx bxl-facebook-square"></i
            ></a>
            <a href="https://www.instagram.com" class="info-logo-item"
            ><i class="bx bxl-instagram"></i
            ></a>
            <a href="https://www.youtube.com" class="info-logo-item"
            ><i class="bx bxl-youtube"></i
            ></a>
        </div>
    </div>
</footer>
<!-- Link to main js -->
<script src="/static/js/home.js"></script>
<form action="/confirm" method="post" id="confirmForm">
    <input type="hidden" name="userId" id="userId">
    <input type="hidden" name="screeningId" id="screeningId">
</form>

<!--<script>-->
<!--    document.addEventListener("DOMContentLoaded", function () {-->
<!--        confirmAndSetFlagToFalse();-->
<!--    });-->

<!--    function confirmAndSetFlagToFalse() {-->
<!--        let msg = "Your tickets had been sent to your email";-->
<!--        // Display a SweetAlert when the document is ready-->
<!--        Swal.fire({-->
<!--            title: msg,-->
<!--            showClass: {-->
<!--                popup: 'animate__animated animate__fadeInDown'-->
<!--            },-->
<!--            hideClass: {-->
<!--                popup: 'animate__animated animate__fadeOutUp'-->
<!--            }-->
<!--        })-->
<!--        document.getElementById("userId").value = document.getElementById("userIdHidden").innerText;-->
<!--        document.getElementById("screeningId").value = document.getElementById("screeningId").innerText;-->
<!--        document.getElementById("confirmForm").submit();-->
<!--    }-->
<!--</script>-->

<script>
    function toLogin() {
        window.location.href = "/login";
    }

    function toLogout() {
        window.location.href = "/logout";
    }

    function toPreference() {
        window.location.href = "/preference";
    }

    function toCustomerDetails() {
        document.getElementById("toCustomerPreference").submit();
    }
    function toSearch() {
        let name = document.getElementById("search-input").value;
        window.location.href = "?name="+name;
    }
</script>
</body>
</html>
