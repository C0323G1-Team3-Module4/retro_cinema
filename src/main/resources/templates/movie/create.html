<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Retro Cinema</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!--    <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>-->
<!--    <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-storage.js"></script>-->

</head>
<body>
<section class="vh-100" style="background-color: #eee;">
    <div class="container h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-lg-12 col-xl-11">
                <div class="card text-black" style="border-radius: 25px;">
                    <div class="card-body p-md-5">
                        <div class="row justify-content-center">
                            <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">

                                <p class="text-center h1 fw-bold mb-5 mx-1 mx-md-4 mt-4">Add new Movie</p>

                                <form class="mx-1 mx-md-4" th:action="@{/movie/create}" method="post"
                                      th:object="${movieDto}">

                                    <div class="d-flex flex-row align-items-center mb-4">
                                        <i class="fas fa-user fa-lg me-3 fa-fw"></i>
                                        <div class="form-outline flex-fill mb-0">
                                            <small style="color: red" th:if="${#fields.hasErrors('movieName')}"
                                                   th:errors="*{movieName}"></small>
                                            <input type="text" id="form3Example1c" class="form-control"
                                                   th:field="*{movieName}"/>
                                            <label class="form-label" for="form3Example1c">Movie Name</label>
                                        </div>
                                    </div>

                                    <div class="d-flex flex-row align-items-center mb-4">
                                        <i class="fas fa-user fa-lg me-3 fa-fw"></i>
                                        <div class="form-outline flex-fill mb-0">
                                            <small style="color: red" th:if="${#fields.hasErrors('duration')}"
                                                   th:errors="*{duration}"></small>
                                            <input type="number" id="form3Example1ce" class="form-control"
                                                   th:field="*{duration}"/>
                                            <label class="form-label" for="form3Example1ce">Duration</label>
                                        </div>
                                    </div>

                                    <div class="d-flex flex-row align-items-center mb-4">
                                        <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                                        <div class="form-outline flex-fill mb-0">
                                            <small style="color: red" th:if="${#fields.hasErrors('description')}"
                                                   th:errors="*{description}"></small>
                                            <input type="text" id="form3Example3c" class="form-control"
                                                   th:field="*{description}"/>
                                            <label class="form-label" for="form3Example3c">Description</label>
                                        </div>
                                    </div>

                                    <div class="d-flex flex-row align-items-center mb-4">
                                        <i class="fas fa-lock fa-lg me-3 fa-fw"></i>
                                        <div class="form-outline flex-fill mb-0">
                                            <small style="color: red" th:if="${#fields.hasErrors('releaseDate')}"
                                                   th:errors="*{releaseDate}"></small>
                                            <input type="date" id="form3Example4c" class="form-control"
                                                   th:field="*{releaseDate}"/>
                                            <label class="form-label" for="form3Example4c">ReleaseDate</label>
                                        </div>
                                    </div>

                                    <div class="d-flex flex-row align-items-center mb-4">
                                        <i class="fas fa-key fa-lg me-3 fa-fw"></i>
                                        <div class="form-outline flex-fill mb-0">
                                            <small style="color: red" th:if="${#fields.hasErrors('director')}"
                                                   th:errors="*{director}"></small>
                                            <input type="text" id="form3Example4cd" class="form-control"
                                                   th:field="*{director}"/>
                                            <label class="form-label" for="form3Example4cd">Director</label>
                                        </div>
                                    </div>

                                    <div class="d-flex flex-row align-items-center mb-4">
                                        <i class="fas fa-key fa-lg me-3 fa-fw"></i>
                                        <div class="form-outline flex-fill mb-0">
                                            <small style="color: red" th:if="${#fields.hasErrors('performer')}"
                                                   th:errors="*{performer}"></small>
                                            <input type="text" id="form3Example4ca" class="form-control"
                                                   th:field="*{performer}"/>
                                            <label class="form-label" for="form3Example4ca">Performer</label>
                                        </div>
                                    </div>

                                    <div class="d-flex flex-row align-items-center mb-4">
                                        <i class="fas fa-key fa-lg me-3 fa-fw"></i>
                                        <div class="form-outline flex-fill mb-0">
                                            <b>Choose picture: Poster Film</b>
                                             <input type="hidden" id="thumbnailURL" th:field="*{img}"/>
                                            <input id="btnThumbnailURL" type="file" class="form-control"/>
                                            <progress id="uploader" value="0" max="100">0%</progress><br>
                                            <small style="color: red" th:if="${#fields.hasErrors('img')}"
                                                   th:errors="*{img}"></small>
                                        </div>
                                    </div>


                                    <div class="d-flex flex-row align-items-center mb-4">
                                        <i class="fas fa-key fa-lg me-3 fa-fw"></i>
                                        <div class="form-outline flex-fill mb-0">
                                            <b>Choose picture: Image Film</b>
                                            <input type="hidden" id="thumbnailURL1" th:field="*{imgTrailer}"/>
                                            <input id="btnThumbnailURL1" type="file" class="form-control"/>
                                            <progress id="uploader1" value="0" max="100">0%</progress><br>
                                            <small style="color: red" th:if="${#fields.hasErrors('imgTrailer')}"
                                                   th:errors="*{imgTrailer}"></small>
                                        </div>
                                    </div>

                                    <div class="d-flex flex-row align-items-center mb-4">
                                        <i class="fas fa-key fa-lg me-3 fa-fw"></i>
                                        <div class="form-outline flex-fill mb-0">
                                            <small style="color: red" th:if="${#fields.hasErrors('trailer')}"
                                                   th:errors="*{trailer}"></small>
                                            <input type="text" id="form3Example4ci" class="form-control"
                                                   th:field="*{trailer}"/>
                                            <label class="form-label" for="form3Example4ci">Trailer</label>
                                        </div>
                                    </div>

                                    <div class="d-flex flex-row align-items-center mb-4">
                                        <i class="fas fa-key fa-lg me-3 fa-fw"></i>
                                        <div class="form-outline flex-fill mb-0">
                                            <small style="color: red" th:if="${#fields.hasErrors('price')}"
                                                   th:errors="*{price}"></small>
                                            <input type="number" id="form3Example4cu" class="form-control"
                                                   th:field="*{price}"/>
                                            <label class="form-label" for="form3Example4cu">Price</label>
                                        </div>
                                    </div>

                                    <div class="d-flex flex-row align-items-center mb-4">
                                        <i class="fas fa-key fa-lg me-3 fa-fw"></i>
                                        <div class="form-outline flex-fill mb-0">
                                            <small style="color: red" th:if="${#fields.hasErrors('movieTypes')}"
                                                   th:errors="*{movieTypes}"></small><br>
                                            <select th:field="*{movieTypes}" id="form3Example4cq">
                                                <option value="">--Movie Types--</option>
                                                <option th:each="m : ${movieTypes}"
                                                        th:value="${m.id}" th:text="${m.movieTypes}"></option>
                                            </select>
<!--                                            <label class="form-label" for="form3Example4cq">Movie Types</label>-->
                                        </div>
                                    </div>

                                    <div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
                                        <button class="btn btn-primary btn-lg">Add new</button>
                                    </div>

                                </form>

                            </div>
                            <div class="col-md-10 col-lg-6 col-xl-7 d-flex align-items-center order-1 order-lg-2">

                                <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-registration/draw1.webp"
                                     class="img-fluid" alt="Sample image">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-analytics.js"></script>

<script>
    //paste here your copied configuration code
    const firebaseConfig = {
        apiKey: "AIzaSyCp05n7nwMvb43hJJZZVQn4ucIPKa2_gkA",
        authDomain: "retro-cinema-99f73.firebaseapp.com",
        projectId: "retro-cinema-99f73",
        storageBucket: "retro-cinema-99f73.appspot.com",
        messagingSenderId: "408180950215",
        appId: "1:408180950215:web:4b49fe816a9038473eaae2",
        measurementId: "G-8MJW1J4QL7"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    // const analytics = getAnalytics(app);
    let uploader = document.getElementById('uploader');
    let fileButton = document.getElementById('btnThumbnailURL');
    fileButton.addEventListener('change', function (e) {
        let file = e.target.files[0];
        let storageRef = firebase.storage().ref('retro/' + file.name);
        let task = storageRef.put(file);
        task.on('state_changed', function progress(snapshot) {
            let percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            uploader.value = percentage;
//  lúc chưa load xong thì thì ko cho submit
            if (percentage === 100) {
                document.getElementById('createButton').removeAttribute('disabled');
            } else {
                document.getElementById('createButton').setAttribute('disabled', 'disabled');
            }
        });
//   getDownloadURL() để lấy URL của file đã được lưu trữ trên Firebase Storage.
//   Sau khi URL được lấy thành công, nó được sử dụng để đặt giá trị cho thuộc tính value của phần tử HTML có id là thumbnailURL.
//   Điều này có nghĩa là URL được gán cho giá trị của trường input có tên là thumbnailURL.
//   Sau đó, URL này có thể được sử dụng để hiển thị hình ảnh hoặc thực hiện các thao tác khác liên quan đến hình ảnh trong code JavaScript và HTML.
        task.then(snapshot => snapshot.ref.getDownloadURL())
            .then(url => {
                document.getElementById('thumbnailURL').setAttribute("value", url);
// tải hình ảnh
                previewImage.style.display = 'none';
                newImage.src = url;
                newImage.style.display = 'block';
            });
    });

    // firebase thứ 2

    // Initialize Firebase
    // firebase.initializeApp(firebaseConfig);
    // const analytics = getAnalytics(app);
    let uploader1 = document.getElementById('uploader1');
    let fileButton1 = document.getElementById('btnThumbnailURL1');
    fileButton1.addEventListener('change', function (e) {
        let file = e.target.files[0];
        let storageRef = firebase.storage().ref('retro2/' + file.name);
        let task = storageRef.put(file);
        task.on('state_changed', function progress(snapshot) {
            let percentage = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            uploader1.value = percentage;
//  lúc chưa load xong thì thì ko cho submit
            if (percentage === 100) {
                document.getElementById('createButton').removeAttribute('disabled');
            } else {
                document.getElementById('createButton').setAttribute('disabled', 'disabled');
            }
        });
//   getDownloadURL() để lấy URL của file đã được lưu trữ trên Firebase Storage.
//   Sau khi URL được lấy thành công, nó được sử dụng để đặt giá trị cho thuộc tính value của phần tử HTML có id là thumbnailURL.
//   Điều này có nghĩa là URL được gán cho giá trị của trường input có tên là thumbnailURL.
//   Sau đó, URL này có thể được sử dụng để hiển thị hình ảnh hoặc thực hiện các thao tác khác liên quan đến hình ảnh trong code JavaScript và HTML.
        task.then(snapshot => snapshot.ref.getDownloadURL())
            .then(url => {
                document.getElementById('thumbnailURL1').setAttribute("value", url);
// tải hình ảnh
                previewImage.style.display = 'none';
                newImage.src = url;
                newImage.style.display = 'block';
            });
    });

</script>
</body>
</html>